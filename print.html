<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>rocketOS</title>
                <meta name="robots" content="noindex" />
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Documentation of rocketOS along with a brief description of technologies used.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="favicon.svg">
                        <link rel="shortcut icon" href="favicon.png">
                <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
                <link rel="stylesheet" href="css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="rocketOS.html">rocketOS</a></li><li class="chapter-item expanded "><a href="build.html"><strong aria-hidden="true">1.</strong> Build Instructions</a></li><li class="chapter-item expanded "><a href="ttols/tools.html"><strong aria-hidden="true">2.</strong> Tools</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="tools/docker.html"><strong aria-hidden="true">2.1.</strong> Docker</a></li><li class="chapter-item expanded "><a href="tools/packer.html"><strong aria-hidden="true">2.2.</strong> Packer</a></li><li class="chapter-item expanded "><a href="tools/qemu.html"><strong aria-hidden="true">2.3.</strong> QEMU</a></li><li class="chapter-item expanded "><a href="tools/systemctl.html"><strong aria-hidden="true">2.4.</strong> systemctl</a></li></ol></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">rocketOS</h1>

                    <div class="right-buttons">
                                                <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="rocketos"><a class="header" href="#rocketos">rocketOS</a></h1>
<p><strong>rocketOS</strong> is a customized distribution of Linux designed for use on Raspberry Pi based flight computers in student rocketry. It is based on a <strong>Unbuntu Server 20.04</strong> distribution that has been patched with the <strong>PREEMPT_RT</strong> kernel patch to allow for soft real-time behaviour. Additional tweaks have been made to improve the CPU latency of the flight computer.</p>
<p>The main advantage of <strong>rocketOS</strong> is the fully automated, containerized build system. By automating the compilation, patching and provisioning of the operating system of the flight computer, a large amount of knowledge of the system becomes fully documented, transparent and portable. Modifications to the operating system can be tracked under version control and several potential errors in the setup of new flight computers can be eliminated.</p>
<p>This project intended to lower the bar of entry to development on Linux while at the same time increasing the ability of student organizations to retain knowledge and onboard new members, hopefully opening the door to more complex software projects in student rocketry.</p>
<p>Future work will build upon <strong>rocketOS</strong> with <strong>ROS2</strong> based flight software.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="build-instructions"><a class="header" href="#build-instructions">Build instructions</a></h1>
<h3 id="1-install-docker"><a class="header" href="#1-install-docker">1. Install Docker</a></h3>
<ul>
<li><a href="https://docs.docker.com/docker-for-mac/install/">macOS</a></li>
<li><a href="https://docs.docker.com/docker-for-windows/install/">Windows</a></li>
<li><a href="https://docs.docker.com/engine/install/ubuntu/">Ubuntu</a></li>
</ul>
<p>Windows users will have to install <a href="https://docs.microsoft.com/en-us/windows/wsl/install-win10">WSL</a> first.</p>
<h3 id="2-open-a-terminal-in-the-repository-root"><a class="header" href="#2-open-a-terminal-in-the-repository-root">2. Open a terminal in the repository root</a></h3>
<p>Run the following:</p>
<p><code>docker build . -f rocketOS.Dockerfile -t rocketos --build-arg RPI_VERSION=4</code> </p>
<p><code>docker run --rm --privileged -v /dev:/dev -v ${PWD}:/build -v ${PWD}:/rocketOS.pkr.hcl -i rocketos:latest</code></p>
<h3 id="3-flash-an-sd-card"><a class="header" href="#3-flash-an-sd-card">3. Flash an SD card</a></h3>
<p>Using the <a href="https://www.raspberrypi.org/software/">Raspberry Pi Imager</a>, flash an SD card with the created <code>.img</code> file.</p>
<h3 id="4-ssh-into-your-rpi"><a class="header" href="#4-ssh-into-your-rpi">4. SSH into your RPI</a></h3>
<p>The default login command is:</p>
<p><code>ssh user@10.0.0.130</code></p>
<p>The default password is:</p>
<p><code>pwd</code></p>
<p>Note that it will take a couple minutes for you to be able to log in to the Raspberry Pi on the first boot while the OS is performing some final configurations.</p>
<h2 id="configuration"><a class="header" href="#configuration">Configuration</a></h2>
<p>Configurations can be made to the compilation of the real-time kernel during the build step. NOTE: THIS IS UNTESTED.</p>
<p><code>RPI_VERSION=3</code></p>
<p>Configurations can be made to your rocketOS image during the <code>docker run</code> step. By adding the extra arguments below you can override the default values defined in the <code>.pkr.hcl</code> file.</p>
<p><code>-e PKR_VAR_user=</code></p>
<p><code>-e PKR_VAR_password=</code></p>
<p><code>-e PKR_VAR_hostname=</code></p>
<p><code>-e PKR_VAR_ip=</code></p>
<p><code>-e PKR_VAR_netmask=</code></p>
<p><code>-e PKR_VAR_gateway=</code></p>
<h2 id="debugging-the-docker-container"><a class="header" href="#debugging-the-docker-container">Debugging the Docker Container</a></h2>
<p>The Docker container can be started and left running until <code>exit</code> with the command:</p>
<p><code>docker run -i --entrypoint=/bin/bash rocketOS:latest</code></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tools"><a class="header" href="#tools">Tools</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="docker"><a class="header" href="#docker">Docker</a></h1>
<p><strong>Docker</strong> provides a virtual environment to build and run applications. By expressing all the build dependencies and steps required to build your software in a <code>.Dockerfile</code>, your build process becomes completely automated and portable. Other developers can compile your software with a <code>docker build</code> command as opposed to manually installing all the dependencies and executing the build commands themselves. Docker containers can also be run with <code>docker run</code> to execute some process or provide some software service.</p>
<p>This project performs the following during <code>docker build</code></p>
<ul>
<li>Setup kernel build tools</li>
<li>Pull rpi kernel source</li>
<li>Pull PREEMPT_RT kernel patch</li>
<li>Patch rpi kernel source</li>
<li>Configure kernel</li>
<li>Compile kernel</li>
<li>Setup packer-builder-arm build tools</li>
<li>Pull packer-builder-arm source</li>
<li>Compile packer-builder-arm</li>
<li>Install Packer</li>
<li>Install packer-builder-arm as Packer plugin</li>
<li>Setup container for running Packer</li>
</ul>
<p>During <code>docker run</code></p>
<ul>
<li>Run Packer build to create a provisioned Ubuntu image</li>
</ul>
<hr />
<h3 id="references"><a class="header" href="#references">References</a></h3>
<ul>
<li><a href="https://www.docker.com/">Docker</a></li>
<li><a href="https://www.ibm.com/cloud/learn/docker">Good Intro</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="packer"><a class="header" href="#packer">Packer</a></h1>
<p><strong>Packer</strong> is a provisioning tool that you create pre-configured images of operating systems that have your required software pre-installed. By defining a <code>.pck.hcl</code> file and running <code>packer build</code> your operating system is started in a virtual environment and all the steps required to configure your system, install your software and copy over any files you need are performed. An image is then created ready for deployment on your hardware.</p>
<p><strong>Packer</strong> cannot normally build for <code>arm</code> architectures, it needs to be extended with the plugin <strong>packer-builder-arm</strong>. This allows you to cross-build your images from <code>x86</code> or <code>amd64</code> host computers. <strong>packer-builder-arm</strong> relies on <strong>QEMU</strong> to do this.</p>
<p>This project performs the following during <code>packer build</code></p>
<ul>
<li>Pulls base Ubuntu Server 20.04 image</li>
<li>Configures SD card partitions</li>
<li>Copies over real-time kernel</li>
<li>Copies over first boot setup scripts</li>
<li>Fixes a set of issues likely resulting from the Packer virtual environment running inside a Docker virtual environment (not relevant for the final product)</li>
<li>Configures user accounts</li>
<li>Installs and configures SSH server</li>
<li>Configures network</li>
<li>Installs real-time diagnostic tools</li>
<li>Configures CPU settings for better performance</li>
</ul>
<hr />
<h3 id="resources"><a class="header" href="#resources">Resources</a></h3>
<ul>
<li><a href="https://www.packer.io/">Packer</a></li>
<li><a href="https://github.com/mkaczanowski/packer-builder-arm">packer-builder-arm</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="qemu"><a class="header" href="#qemu">QEMU</a></h1>
<p><strong>QEMU</strong> is a technology that you will encounter if you dive into the details of how <strong>Docker</strong> and <strong>Packer</strong> work. Most likely you will not need to interact with it directly, but it is helpful to have a general idea of what it is and how it works.</p>
<p><strong>QEMU</strong> lets you create a virtual machine environment, for example, it allows an <code>x86</code> machine to run <code>arm</code> software. Keep in mind that not all things are possible in this environment. Kernel upgrades cannot be done in a <strong>QEMU</strong> environment, which is the reason that this project uses a first boot script to install the real-time kernel.</p>
<hr />
<h3 id="references-1"><a class="header" href="#references-1">References</a></h3>
<ul>
<li><a href="https://www.qemu.org/">QEMU</a></li>
<li><a href="https://www.stereolabs.com/docs/docker/building-arm-container-on-x86/">arm Docker Containers on x86 Machines</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="systemctl"><a class="header" href="#systemctl">systemctl</a></h1>
<p><strong>systemctl</strong> is probably the most robust and straightforward way to execute scripts or run software without user interaction on Linux.</p>
<p>This project uses <strong>systemctl</strong> to apply the real-time kernel on the first boot of the operating system on real hardware. The ssh server is also automatically started on every boot by a systemctl service.</p>
<hr />
<h3 id="references-2"><a class="header" href="#references-2">References</a></h3>
<ul>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-use-systemctl-to-manage-systemd-services-and-units">How to use systemctl</a></li>
<li><a href="https://www.digitalocean.com/community/tutorials/understanding-systemd-units-and-unit-files">How to write new services</a></li>
<li><a href="https://www.freedesktop.org/software/systemd/man/systemd.service.html">Service file manual</a></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
                        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
                
    </body>
</html>
